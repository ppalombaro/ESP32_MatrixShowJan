/* HolidayAnimations.h
   Animated effects for all holidays
   VERSION: V14.0-2025-12-27T16:30:00Z - Multi-holiday support
*/

#ifndef HOLIDAY_ANIMATIONS_H
#define HOLIDAY_ANIMATIONS_H

#include "MatrixDisplay.h"
#include "Config.h"
#include <NTPClient.h>

// V15.3.2-2026-01-04T18:00:00Z - JSON Animation Loader
#include <ArduinoJson.h>
#include <SPIFFS.h>

class AnimationLoader {
public:
    AnimationLoader(MatrixDisplay* display);
    
    bool loadTimeline(const char* theme, const char* animName);
    void update();
    void begin();
    bool isPlaying();
    
private:
    MatrixDisplay* disp;
    
    struct Frame {
        String sceneId;
        int durationMs;
    };
    
    Frame frames[50];  // Max 50 frames per animation
    int frameCount;
    int currentFrame;
    unsigned long lastFrameTime;
    bool playing;
    bool loop;
    
    String basePath;
    SceneData* sceneData;  // Reuse SceneData for rendering frames
};

// ============== HALLOWEEN ANIMATIONS ==============

// V14.0: Flying bats animation (crosses both matrices)
class FlyingBatsAnimation {
public:
    FlyingBatsAnimation(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    struct Bat {
        float x;
        int y;
        float speed;
        int direction;  // 1 = left to right, -1 = right to left
    };
    static const int MAX_BATS = 5;
    Bat bats[MAX_BATS];
    unsigned long lastUpdate;
};

// V14.0: Pirate ship sailing animation
class PirateShipAnimation {
public:
    PirateShipAnimation(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    float shipX;  // Position across both matrices (0-40)
    int shipY;
    unsigned long lastUpdate;
    void drawShip(int globalX, int y);
};

// V15.3.2-2026-01-04T18:00:00Z - Use AnimationLoader for JSON animations
class BleedingWindowsAnimation {
public:
    BleedingWindowsAnimation(MatrixDisplay* display) {
        loader = new AnimationLoader(display);
    }
    
    void begin() {
        loader->loadTimeline("halloween", "bleeding_windows");
        loader->begin();
    }
    
    void update() {
        loader->update();
    }
    
private:
    AnimationLoader* loader;
};
 
// V14.0: Lightning flash effect
class LightningFlashAnimation {
public:
    LightningFlashAnimation(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    unsigned long lastFlash;
    unsigned long flashDuration;
    bool isFlashing;
    uint8_t flashBrightness;
    unsigned long lastUpdate;
};

// V14.0: Halloween scroll text (Happy Halloween, Trick or Treat)
class HalloweenScrollText {
public:
    HalloweenScrollText(MatrixDisplay* display);
    void begin();
    void update();
    void setMessage(const char* msg);  // "HAPPY HALLOWEEN" or "TRICK OR TREAT"
private:
    MatrixDisplay* disp;
    char message[32];
    int scrollPos;
    unsigned long lastUpdate;
};
/* HolidayAnimations.h UPDATE
   ADD THIS CODE AFTER LINE 93 (after HalloweenScrollText class)
   V15.0.3.1 - 2025-01-03
*/

class SpookyTrackingEyesAnimation {
public:
    SpookyTrackingEyesAnimation(MatrixDisplay* display) {
        loader = new AnimationLoader(display);
    }
    
    void begin() {
        loader->loadTimeline("halloween", "spooky_eyes");
        loader->begin();
    }
    
    void update() {
        loader->update();
    }
    
private:
    AnimationLoader* loader;
};
// ============== THANKSGIVING ANIMATIONS ==============

// V14.0: Thanksgiving scroll text
class ThanksgivingScrollText {
public:
    ThanksgivingScrollText(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    int scrollPos;
    unsigned long lastUpdate;
};

class FallingLeavesAnimation {
public:
    FallingLeavesAnimation(MatrixDisplay* display) {
        loader = new AnimationLoader(display);
    }
    
    void begin() {
        loader->loadTimeline("thanksgiving", "falling_leaves");
        loader->begin();
    }
    
    void update() {
        loader->update();
    }
    
private:
    AnimationLoader* loader;
};

// ============== NEW YEAR ANIMATIONS ==============

// V14.0: New Year countdown (like Christmas countdown but for New Year)
class NewYearCountdown {
public:
    NewYearCountdown(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    unsigned long lastUpdate;
    bool isNewYear;  // When countdown hits 00:00:00
    void drawCountdown(long days, int hours, int minutes, int seconds);
    void drawDigit(int matrix, int x_start, int y_start, int digit, CRGB color);
};

// V14.0: New Year scroll text
class NewYearScrollText {
public:
    NewYearScrollText(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    int scrollPos;
    unsigned long lastUpdate;
};

class FireworksAnimation {
public:
    FireworksAnimation(MatrixDisplay* display) {
        loader = new AnimationLoader(display);
    }
    
    void begin() {
        loader->loadTimeline("newyear", "fireworks");
        loader->begin();
    }
    
    void update() {
        loader->update();
    }
    
private:
    AnimationLoader* loader;
};


lass ColorSpinningStarAnimation {
public:
    ColorSpinningStarAnimation(MatrixDisplay* display) {
        loader = new AnimationLoader(display);
    }
    
    void begin() {
        loader->loadTimeline("newyear", "spinning_star");
        loader->begin();
    }
    
    void update() {
        loader->update();
    }
    
private:
    AnimationLoader* loader;
};


// ============== OHIO STATE ANIMATIONS ==============

// V14.0: OSU scroll text "GO BUCKS!!!"
class OSUScrollText {
public:
    OSUScrollText(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    int scrollPos;
    unsigned long lastUpdate;
};

// V14.0: O-H-I-O letter sequence (O...H on left, then I...O on right)
class OHIOLetterAnimation {
public:
    OHIOLetterAnimation(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    int currentLetter;  // 0=O, 1=H, 2=I, 3=O
    unsigned long lastLetterTime;
    bool showLetter;
    void drawLetter(char letter, int matrix);
};

// V14.0: Red/Gray/White effects for OSU
class OSUColorWaveAnimation {
public:
    OSUColorWaveAnimation(MatrixDisplay* display);
    void begin();
    void update();
private:
    MatrixDisplay* disp;
    int wavePosition;
    unsigned long lastUpdate;
};

#endif // HOLIDAY_ANIMATIONS_H
